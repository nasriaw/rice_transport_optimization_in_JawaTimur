import pulp
import pandas as pd

# Data produksi beras (dalam ton)
produksi_data = {
    'Surabaya': 9259.36, 'Gresik': 224984.02, 'Sidoarjo': 158774.13, 'Mojokerto': 409363.12,
    'Jombang': 251896.77, 'Bojonegoro': 481382.82, 'Lamongan': 573588.87, 'Tuban': 360945.04,
    'Madiun': 523525.09, 'Ngawi': 477704.04, 'Magetan': 185166.52, 'Ponorogo': 241335.26,
    'Pacitan': 57371.14, 'Kediri': 287785.18, 'Nganjuk': 252927.86, 'Tulungagung': 138741.09,
    'Blitar': 289930.30, 'Trenggalek': 77131.59, 'Malang': 376073.16, 'Pasuruan': 394553.87,
    'Probolinggo': 229587.20, 'Lumajang': 198778.34, 'Bondowoso': 162378.43, 'Situbondo': 112302.64,
    'Jember': 440631.34, 'Banyuwangi': 329144.06, 'Bangkalan': 155902.39, 'Sampang': 120928.94,
    'Pamekasan': 73040.60, 'Sumenep': 165224.91
}

# Data konsumsi beras (dalam ton)
konsumsi_data = {
    'Surabaya': 314241, 'Gresik': 141465, 'Sidoarjo': 241408, 'Mojokerto': 255452,
    'Jombang': 137061, 'Bojonegoro': 135792, 'Lamongan': 129472, 'Tuban': 127223,
    'Madiun': 167646, 'Ngawi': 90401, 'Magetan': 68489, 'Ponorogo': 94817,
    'Pacitan': 60375, 'Kediri': 372641, 'Nganjuk': 114551, 'Tulungagung': 112742,
    'Blitar': 267458, 'Trenggalek': 75674, 'Malang': 658817, 'Pasuruan': 373768,
    'Probolinggo': 278714, 'Lumajang': 113233, 'Bondowoso': 84105, 'Situbondo': 74048,
    'Jember': 265792, 'Banyuwangi': 175295, 'Bangkalan': 106604, 'Sampang': 105473,
    'Pamekasan': 94907, 'Sumenep': 118181
}

# String data biaya transportasi
biaya_str = """
0 | Kota | Surabaya | Gresik | Sidoarjo | Mojokerto | Jombang | Bojonegoro | Lamongan  | Tuban | Madiun  | Ngawi | Magetan | Ponorogo | Pacitan | Kediri | Nganjuk | Tulungagung | Blitar | Trenggalek  | Malang | Pasuruan  | Probolinggo | Lumajang | Bondowoso | Situbondo | Jember | Banyuwangi | Bangkalan | Sampang | Pamekasan | Sumenep
1 | Surabaya |  -    | 63252.00 | 80822.00 | 172186.00 | 277606.00 | 379512.00 | 158130.00 | 361942.00 | 593866.00 | 636034.00 | 678202.00 | 695772.00 | 969864.00 | 432222.00 | 418166.00 | 541156.00 | 586838.00 | 653604.00 | 312746.00 | 210840.00 | 347886.00 | 509530.00 | 671174.00 | 681716.00 | 692258.00 | 1012032.00 | 98392.00 | 316260.00 | 432222.00 | 614950.00
2 | Gresik | 63252.00 |  -    | 144074.00 | 235438.00 | 340858.00 | 316260.00 | 94878.00 | 298690.00 | 657118.00 | 699286.00 | 741454.00 | 759024.00 | 1033116.00 | 495474.00 | 481418.00 | 604408.00 | 650090.00 | 716856.00 | 375998.00 | 274092.00 | 411138.00 | 572782.00 | 734426.00 | 744968.00 | 755510.00 | 1075284.00 | 161644.00 | 379512.00 | 495474.00 | 678202.00
3 | Sidoarjo | 80822.00 | 144074.00 |  -    | 253008.00 | 358428.00 | 460334.00 | 238952.00 | 442764.00 | 674688.00 | 716856.00 | 759024.00 | 776594.00 | 1047172.00 | 509530.00 | 498988.00 | 621978.00 | 506016.00 | 730912.00 | 231924.00 | 130018.00 | 267064.00 | 428708.00 | 590352.00 | 600894.00 | 611436.00 | 931210.00 | 179214.00 | 397082.00 | 513044.00 | 695772.00
4 | Mojokerto | 172186.00 | 235438.00 | 253008.00 |  -    | 105420.00 | 404110.00 | 200298.00 | 386540.00 | 421680.00 | 463848.00 | 506016.00 | 523586.00 | 797678.00 | 260036.00 | 245980.00 | 368970.00 | 414652.00 | 481418.00 | 302204.00 | 214354.00 | 351400.00 | 513044.00 | 674688.00 | 685230.00 | 695772.00 | 1015546.00 | 270578.00 | 488446.00 | 604408.00 | 787136.00
5 | Jombang | 277606.00 | 340858.00 | 358428.00 | 105420.00 |  -    | 298690.00 | 281120.00 | 284634.00 | 316260.00 | 358428.00 | 400596.00 | 418166.00 | 692258.00 | 154616.00 | 140560.00 | 263550.00 | 309232.00 | 375998.00 | 418166.00 | 319774.00 | 456820.00 | 618464.00 | 780108.00 | 790650.00 | 801192.00 | 1120966.00 | 375998.00 | 593866.00 | 709828.00 | 892556.00
6 | Bojonegoro | 379512.00 | 316260.00 | 460334.00 | 404110.00 | 298690.00 |  -    | 221382.00 | 228410.00 | 386540.00 | 274092.00 | 393568.00 | 488446.00 | 762538.00 | 453306.00 | 439250.00 | 562240.00 | 607922.00 | 674688.00 | 692258.00 | 590352.00 | 727398.00 | 889042.00 | 1047172.00 | 709828.00 | 1071770.00 | 1391544.00 | 477904.00 | 695772.00 | 811734.00 | 994462.00
7 | Lamongan  | 158130.00 | 94878.00 | 238952.00 | 200298.00 | 281120.00 | 221382.00 |  -    | 203812.00 | 621978.00 | 657118.00 | 706314.00 | 723884.00 | 997976.00 | 460334.00 | 446278.00 | 569268.00 | 614950.00 | 681716.00 | 470876.00 | 368970.00 | 506016.00 | 667660.00 | 829304.00 | 839846.00 | 850388.00 | 1170162.00 | 256522.00 | 474390.00 | 590352.00 | 773080.00
8 | Tuban | 361942.00 | 333830.00 | 442764.00 | 386540.00 | 288148.00 | 228410.00 | 203812.00 |  -    | 604408.00 | 646576.00 | 688744.00 | 706314.00 | 980406.00 | 442764.00 | 428708.00 | 551698.00 | 597380.00 | 664146.00 | 671174.00 | 572782.00 | 709828.00 | 871472.00 | 997976.00 | 1043658.00 | 1054200.00 | 1373974.00 | 460334.00 | 678202.00 | 794164.00 | 976892.00
9 | Madiun  | 593866.00 | 657118.00 | 674688.00 | 449792.00 | 316260.00 | 386540.00 | 621978.00 | 639548.00 |  -    | 112448.00 | 84336.00 | 101906.00 | 375998.00 | 274092.00 | 175700.00 | 383026.00 | 428708.00 | 288148.00 | 625492.00 | 636034.00 | 773080.00 | 934724.00 | 1096368.00 | 1106910.00 | 1187732.00 | 1430198.00 | 446278.00 | 910126.00 | 1026088.00 | 1208816.00
10 | Ngawi | 636034.00 | 699286.00 | 927696.00 | 463848.00 | 358428.00 | 274092.00 | 664146.00 | 646576.00 | 112448.00 |  -    | 119476.00 | 214354.00 | 488446.00 | 316260.00 | 217868.00 | 425194.00 | 470876.00 | 400596.00 | 667660.00 | 678202.00 | 815248.00 | 976892.00 | 1138536.00 | 1149078.00 | 1159620.00 | 147588.00 | 1437226.00 | 952294.00 | 1068256.00 | 1250984.00
11 | Magetan | 678202.00 | 741454.00 | 759024.00 | 506016.00 | 400596.00 | 397082.00 | 706314.00 | 667660.00 | 84336.00 | 119476.00 |  -    | 186242.00 | 460334.00 | 358428.00 | 260036.00 | 467362.00 | 513044.00 | 372484.00 | 709828.00 | 720370.00 | 857416.00 | 1019060.00 | 1180704.00 | 1191246.00 | 1201788.00 | 1521562.00 | 776594.00 | 1345862.00 | 1110424.00 | 1293152.00
12 | Ponorogo | 695772.00 | 759024.00 | 776594.00 | 520072.00 | 418166.00 | 488446.00 | 723884.00 | 706314.00 | 101906.00 | 214354.00 | 186242.00 |  -    | 274092.00 | 404110.00 | 277606.00 | 295176.00 | 411138.00 | 182728.00 | 685230.00 | 737940.00 | 874986.00 | 741454.00 | 1198274.00 | 1208816.00 | 1219358.00 | 1539132.00 | 794164.00 | 994462.00 | 1127994.00 | 1310722.00
13 | Pacitan | 969864.00 | 1033116.00 | 1047172.00 | 797678.00 | 692258.00 | 762538.00 | 997976.00 | 629006.00 | 375998.00 | 488446.00 | 460334.00 | 274092.00 |  -    | 632520.00 | 551698.00 | 523586.00 | 639548.00 | 411138.00 | 948780.00 | 748482.00 | 1236928.00 | 969864.00 | 1370460.00 | 1479394.00 | 1258012.00 | 1623468.00 | 1279096.00 | 1286124.00 | 1402086.00 | 1584814.00
14 | Kediri | 432222.00 | 495474.00 | 513044.00 | 165158.00 | 154616.00 | 453306.00 | 460334.00 | 442764.00 | 274092.00 | 316260.00 | 358428.00 | 404110.00 | 632520.00 |  -    | 98392.00 | 108934.00 | 154616.00 | 221382.00 | 351400.00 | 548184.00 | 681716.00 | 762538.00 | 1356404.00 | 1015546.00 | 1050686.00 | 1345862.00 | 530614.00 | 748482.00 | 864444.00 | 1040144.00
15 | Nganjuk | 418166.00 | 481418.00 | 498988.00 | 245980.00 | 140560.00 | 439250.00 | 446278.00 | 428708.00 | 175700.00 | 217868.00 | 260036.00 | 277606.00 | 551698.00 | 98392.00 |  -    | 207326.00 | 253008.00 | 337344.00 | 449792.00 | 460334.00 | 597380.00 | 759024.00 | 990948.00 | 1001490.00 | 941752.00 | 1261526.00 | 516558.00 | 734426.00 | 850388.00 | 1033116.00
16 | Tulungagung | 541156.00 | 604408.00 | 621978.00 | 368970.00 | 263550.00 | 562240.00 | 569268.00 | 551698.00 | 383026.00 | 425194.00 | 463848.00 | 295176.00 | 523586.00 | 108934.00 | 207326.00 |  -    | 115962.00 | 112448.00 | 390054.00 | 231924.00 | 720370.00 | 720370.00 | 1043658.00 | 1054200.00 | 1064742.00 | 1384516.00 | 639548.00 | 857416.00 | 973378.00 | 1156106.00
17 | Blitar | 586838.00 | 650090.00 | 506016.00 | 414652.00 | 302204.00 | 607922.00 | 614950.00 | 597380.00 | 428708.00 | 470876.00 | 513044.00 | 411138.00 | 639548.00 | 154616.00 | 253008.00 | 115962.00 |  -    | 224896.00 | 274092.00 | 467362.00 | 604408.00 | 604408.00 | 927696.00 | 938238.00 | 948780.00 | 1268554.00 | 685230.00 | 903098.00 | 1019060.00 | 1201788.00
18 | Trenggalek  | 688744.00 | 716856.00 | 723884.00 | 481418.00 | 375998.00 | 674688.00 | 681716.00 | 664146.00 | 288148.00 | 506016.00 | 372484.00 | 182728.00 | 411138.00 | 221382.00 | 316260.00 | 112448.00 | 224896.00 |  -    | 498988.00 | 692258.00 | 829304.00 | 829304.00 | 1152592.00 | 1163134.00 | 1173676.00 | 1493450.00 | 751996.00 | 969864.00 | 1261526.00 | 1268554.00
19 | Malang | 312746.00 | 375998.00 | 231924.00 | 312746.00 | 418166.00 | 692258.00 | 470876.00 | 674688.00 | 625492.00 | 667660.00 | 709828.00 | 685230.00 | 1019060.00 | 351400.00 | 91364.00 | 390054.00 | 274092.00 | 498988.00 |  -    | 193270.00 | 330316.00 | 411138.00 | 681716.00 | 664146.00 | 674688.00 | 910126.00 | 411138.00 | 629006.00 | 744968.00 | 927696.00
20 | Pasuruan  | 210840.00 | 274092.00 | 130018.00 | 214354.00 | 319774.00 | 590352.00 | 368970.00 | 572782.00 | 636034.00 | 678202.00 | 720370.00 | 737940.00 | 1099882.00 | 544670.00 | 460334.00 | 583324.00 | 467362.00 | 692258.00 | 193270.00 |  -    | 137046.00 | 298690.00 | 460334.00 | 470876.00 | 481418.00 | 801192.00 | 302204.00 | 527100.00 | 643062.00 | 825790.00
21 | Probolinggo | 316260.00 | 411138.00 | 267064.00 | 351400.00 | 456820.00 | 727398.00 | 506016.00 | 709828.00 | 773080.00 | 463848.00 | 857416.00 | 843360.00 | 1236928.00 | 681716.00 | 597380.00 | 720370.00 | 604408.00 | 829304.00 | 330316.00 | 137046.00 |  -    | 161644.00 | 323288.00 | 333830.00 | 337344.00 | 664146.00 | 446278.00 | 664146.00 | 780108.00 | 962836.00
22 | Lumajang | 509530.00 | 572782.00 | 428708.00 | 523586.00 | 618464.00 | 889042.00 | 667660.00 | 871472.00 | 934724.00 | 969864.00 | 1019060.00 | 776594.00 | 969864.00 | 762538.00 | 759024.00 | 720370.00 | 604408.00 | 829304.00 | 411138.00 | 298690.00 | 161644.00 |  -    | 368970.00 | 491960.00 | 604408.00 | 621978.00 | 607922.00 | 825790.00 | 941752.00 | 1124480.00
23 | Bondowoso | 671174.00 | 734426.00 | 590352.00 | 674688.00 | 780108.00 | 1050686.00 | 829304.00 | 1033116.00 | 1096368.00 | 1138536.00 | 1180704.00 | 1198274.00 | 1370460.00 | 1356404.00 | 1272068.00 | 1043658.00 | 927696.00 | 1152592.00 | 653604.00 | 460334.00 | 323288.00 | 368970.00 |  -    | 122990.00 | 112448.00 | 442764.00 | 769566.00 | 987434.00 | 1103396.00 | 1391544.00
24 | Situbondo | 681716.00 | 744968.00 | 600894.00 | 685230.00 | 790650.00 | 1061228.00 | 839846.00 | 1043658.00 | 1212330.00 | 1149078.00 | 1191246.00 | 1208816.00 | 1479394.00 | 1015546.00 | 730912.00 | 1054200.00 | 938238.00 | 1163134.00 | 586838.00 | 470876.00 | 333830.00 | 491960.00 | 122990.00 |  -    | 235438.00 | 330316.00 | 780108.00 | 997976.00 | 1113938.00 | 1366946.00
25 | Jember | 692258.00 | 755510.00 | 611436.00 | 688744.00 | 801192.00 | 1071770.00 | 850388.00 | 1054200.00 | 1117452.00 | 1159620.00 | 1201788.00 | 1219358.00 | 1258012.00 | 1026088.00 | 941752.00 | 1064742.00 | 948780.00 | 1173676.00 | 674688.00 | 481418.00 | 337344.00 | 253008.00 | 112448.00 | 340858.00 |  -    | 368970.00 | 790650.00 | 1008518.00 | 1124480.00 | 1307208.00
26 | Banyuwangi | 1012032.00 | 1075284.00 | 931210.00 | 1015546.00 | 1120966.00 | 1391544.00 | 1170162.00 | 1373974.00 | 1430198.00 | 1479394.00 | 1521562.00 | 1532104.00 | 1623468.00 | 1345862.00 | 1366946.00 | 1384516.00 | 1268554.00 | 1493450.00 | 839846.00 | 801192.00 | 664146.00 | 621978.00 | 477904.00 | 330316.00 | 368970.00 |  -    | 1110424.00 | 1328292.00 | 1444254.00 | 1626982.00
27 | Bangkalan | 98392.00 | 161644.00 | 179214.00 | 270578.00 | 375998.00 | 477904.00 | 256522.00 | 460334.00 | 692258.00 | 734426.00 | 776594.00 | 794164.00 | 1068256.00 | 530614.00 | 516558.00 | 639548.00 | 685230.00 | 751996.00 | 411138.00 | 302204.00 | 446278.00 | 607922.00 | 769566.00 | 780108.00 | 790650.00 | 1110424.00 |  -    | 217868.00 | 337344.00 | 516558.00
28 | Sampang | 316260.00 | 379512.00 | 397082.00 | 488446.00 | 593866.00 | 688744.00 | 474390.00 | 678202.00 | 910126.00 | 952294.00 | 994462.00 | 1012032.00 | 1286124.00 | 748482.00 | 734426.00 | 506016.00 | 903098.00 | 969864.00 | 629006.00 | 527100.00 | 664146.00 | 825790.00 | 987434.00 | 1033116.00 | 1008518.00 | 1317750.00 | 217868.00 |  -    | 115962.00 | 298690.00
29 | Pamekasan | 432222.00 | 495474.00 | 509530.00 | 604408.00 | 709828.00 | 811734.00 | 590352.00 | 794164.00 | 1026088.00 | 1068256.00 | 1110424.00 | 1127994.00 | 1402086.00 | 864444.00 | 850388.00 | 973378.00 | 1019060.00 | 1085826.00 | 744968.00 | 643062.00 | 780108.00 | 941752.00 | 1103396.00 | 1113938.00 | 1124480.00 | 1444254.00 | 333830.00 | 115962.00 |  -    | 182728.00
30 | Sumenep | 614950.00 | 678202.00 | 688744.00 | 787136.00 | 892556.00 | 994462.00 | 773080.00 | 976892.00 | 1208816.00 | 1250984.00 | 1293152.00 | 1310722.00 | 1584814.00 | 1005004.00 | 1033116.00 | 1156106.00 | 1201788.00 | 1268554.00 | 927696.00 | 825790.00 | 962836.00 | 1124480.00 | 1391544.00 | 1296666.00 | 1307208.00 | 1626982.00 | 516558.00 | 298690.00 | 182728.00 |  -   
"""

# Fungsi untuk parsing data biaya dari string
def parse_biaya_string(biaya_str):
    lines = [line.strip() for line in biaya_str.strip().split('\n') if line.strip()]
    # Ambil header (nama kota tujuan)
    header = [h.strip() for h in lines[0].split('|')[2:]]
    
    biaya_dict = {}
    for line in lines[1:]:
        parts = [p.strip() for p in line.split('|')]
        kota_asal = parts[1]
        biaya_values = parts[2:]
        
        # Handle kota dengan spasi ganda (misal "Lamongan  " -> "Lamongan")
        kota_asal = kota_asal.strip()
        
        biaya_dict[kota_asal] = {}
        for idx, val in enumerate(biaya_values):
            kota_tujuan = header[idx].strip()
            # Ganti "-" dengan 0 dan konversi ke float
            biaya_val = 0.0 if val.strip() == '-' else float(val.strip())
            biaya_dict[kota_asal][kota_tujuan] = biaya_val
    
    return biaya_dict

# Parse data biaya
biaya_data = parse_biaya_string(biaya_str)

# Inisialisasi model
model = pulp.LpProblem("Transportasi_Beras_Jatim", pulp.LpMinimize)

# Daftar kota
kota = list(produksi_data.keys())

# Variabel keputusan: x[i][j] = ton beras dari kota i ke kota j
x = pulp.LpVariable.dicts("transport",
                          ((i, j) for i in kota for j in kota),
                          lowBound=0,
                          cat='Continuous')

# Fungsi tujuan: minimalkan total biaya transportasi
model += pulp.lpSum(biaya_data[i][j] * x[i, j] for i in kota for j in kota)

# Kendala produksi: total beras yang dikirim dari kota i <= produksi di kota i
for i in kota:
    model += pulp.lpSum(x[i, j] for j in kota) <= produksi_data[i]

# Kendala konsumsi: total beras yang diterima di kota j >= konsumsi di kota j
for j in kota:
    model += pulp.lpSum(x[i, j] for i in kota) >= konsumsi_data[j]

# Selesaikan model
model.solve()

# Tampilkan hasil
print(f"Status: {pulp.LpStatus[model.status]}")
print(f"Total Biaya Transportasi: Rp {pulp.value(model.objective):,.2f}")

# Buat dataframe untuk hasil transportasi
hasil = []
for i in kota:
    for j in kota:
        if pulp.value(x[i, j]) > 0:
            hasil.append({
                'Asal': i,
                'Tujuan': j,
                'Jumlah (Ton)': pulp.value(x[i, j]),
                'Biaya per Ton': biaya_data[i][j],
                'Total Biaya': pulp.value(x[i, j]) * biaya_data[i][j]
            })

df_hasil = pd.DataFrame(hasil)
print("\nRincian Transportasi (Top 10 berdasarkan biaya tertinggi):")
print(df_hasil.sort_values(by='Total Biaya', ascending=False).head(10))

# Simpan hasil ke CSV
df_hasil.to_csv('hasil_transportasi_beras.csv', index=False)
print("\nHasil lengkap telah disimpan ke 'hasil_transportasi_beras.csv'")